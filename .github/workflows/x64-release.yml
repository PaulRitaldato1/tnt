# TODO: 
# 1. find a way to add SDL2 to the build system.
# 2. (maybe) build every dependency with CMake, and then build their solution with msbuild.
# 3. find a way to check if there is a new version of the dependencies and update automatically.
# 4. handle vcpkg actions better.
# 5. (maybe) add more os-es and more build configurations.
# 6. make this cross-platform
# 7. consider building all the dependencies in a single action.
# 8. consider using CMake to convert TnT into a Visual Studio solution/GCC/Clang project

name: CI

on: [push]

jobs:
  get-dependencies:
    name: ${{ matrix.os }}-dependencies
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [windows-latest, ubuntu-latest, macos-latest]
        include:
          - os: windows-latest
            compiler: cl.exe
            build: /EHsc /std:c++latest /O2 /W4 /Iinclude main.cpp src\*.cpp /FeTnT.exe /Fo.\obj\ /link /subsystem:console /machine:x64
            triplet: x64-windows # is this neccesary?
            exporter: setx # is this neccesary?
          - os: ubuntu-latest
            compiler: gcc 
            triplet: x64-linux # is this neccesary?
            exporter: export # is this neccesary?
          - os: macos-latest
            compiler: clang 
            triplet:  x64-osx # is this neccesary?
            exporter: export # is this neccesary?

            
    steps:
      - uses: actions/checkout@v1 # submodules support, is this line necessary?
        with:
          submodules: true # is this necessary?
      - name: Run vcpkg
        run: |
          vcpkg install fmt sol2 nlohmann-json sdl2 sdl2-image sdl2-mixer sdl2-ttf sdl2-net
    
  tnt:
    runs-on: [windows-latest]
    needs: [get-dependencies]
    name: Build TnT
    steps:
      - uses: actions/checkout@v1
      - uses: ilammy/msvc-dev-cmd@v1
      - name: Build TnT.exe
        run: |
          dir
          mkdir obj
          cl /EHsc /std:c++latest /O2 /W4 /Iinclude main.cpp src\*.cpp /FeTnT.exe /Fo.\obj\ /link /subsystem:console /machine:x64
          cls
